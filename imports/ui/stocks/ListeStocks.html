<template name="ListeStocks">
	<h3><span class="glyphicon glyphicon-barcode"></span>&emsp;Gestion du stock</h3>

	<div class="input-group search-section">
	  <span class="to-right">{{> EasySearch.Input index=stocksIndex }}</span>
	  <span class="input-group-addon glyphicon glyphicon-search" aria-hidden="true" id="sizing-addon2"></span>
	</div>
	<span class="to-right results-count"><i>Nombre de résultat(s) : {{resultsCount}}</i></span>

	<section class="stocks">
		{{#if Template.subscriptionsReady}}
			<table class="table-donnees">
				<tr>
					<th class="colonne-icone"></th>
					<th class="colonne-stocks" >Toners</th>
					<th class="colonne-stocks">Quantité</th>
					<th class="colonne-stocks">Services</th>
					<th class="colonne-stocks">Statut</th>
					<th class="colonne-icone"></th>
				</tr>
					{{#EasySearch.Each index=stocksIndex }}
					
					<tr class="row-donnees {{#if avertissement}}{{#if alerte}}warning-al{{else}}warning-av{{/if}}{{/if}}">

						<td>
							<div class="dropdown">
							  <button class="btn btn-default glyphicon glyphicon-cog  dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true"></button>
							  <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
							  	<li>Niveau de seuil</li>
							    <li><button id="augmenteS-{{_id}}" class="glyphicon glyphicon-minus diminue-seuil"></button>
								<button id="diminueS-{{_id}}" class="glyphicon glyphicon-plus augmente-seuil"></button>  {{seuil}}</li>
							    <li role="separator" class="divider"></li>
							    <li>Niveau d'avertissement</li>
							    <li>
							    	<button id="augmenteA-{{_id}}" class="glyphicon glyphicon-minus diminue-avertissement"></button>
									<button id="diminueA-{{_id}}" class=" glyphicon glyphicon-plus augmente-avertissement"></button>  {{nvAvertissement}}
								</li>
							  </ul>
							</div>
						</td>
						{{#with getToner toner}}
						<td>
							 	{{constructeur}} - {{referenceC}} ( {{couleur}} )
						</td>
						{{/with}}
						<td>
							<button id="diminueQ-{{_id}}" class="btn btn-default btn-sm diminue-quantite glyphicon glyphicon-minus"></button>
							<button id="augmenteQ-{{_id}}" class="btn btn-default glyphicon glyphicon-plus augmente-quantite"></button>  {{quantite}}
						</td>
						<td>
							{{#each consommateur}}
					        	<button id="consommer-{{../_id}}" class="btn btn-default btn-sm glyphicon glyphicon-share consommer" data-id="{{../_id}}"></button>
					        	{{#with getSite site}}
					        		{{nom}}
								{{/with}}
								/
								{{#with getService service}}
					        		{{nom}}
								{{/with}}
								{{#with getContact contact}}
									( {{nom}} {{prenom}} )
								{{/with}}
					        	<span class="dropdown">
								  <a href="" class="dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true"><span class="label label-info">{{consommation}}</span></a>
								  <ul class="dropdown-menu" aria-labelledby="dropdownMenu1"  data-id="{{../_id}}">
								  	{{#each (limit historique -6)}}
								  		{{#with getHistorique this}}
								            <li class=""><button class="glyphicon glyphicon-remove-sign consommations-remove" onClick="getGrandParentDataId(this);"></button>&nbsp;Retrait le {{date}}</li>
								        {{/with}}
								  	{{/each}}
								  </ul>
								</span>
								<br />
								<ul>
									{{#each impression}}
										{{#with getImpression this}}
										<li>{{marque}} {{modele}}</li>
										{{/with}}
									{{/each}}
								</ul>
					      	{{/each}}
						</td>
						<td>
							{{#if avertissement}}
								{{#if alerte}}
									ALERTE
								{{else}}
									Avertissement
								{{/if}}
							{{else}}
								OK
							{{/if}}
						</td>
						<td>
							<button class="btn btn-default glyphicon glyphicon-shopping-cart commander" aria-haspopup="true" aria-expanded="true"></button>
						</td>
					</tr>
				{{/EasySearch.Each}}
			</table>
		{{else}}
			<p>En attente</p>
		{{/if}}
	</section>
<br /><br /><br />

	<section>
		<div style="border: thin solid black">
			<h5>INFORMATION</h5>
			<i>Stock critique pour les objets suivants:
			<ul>
				{{#each infoAlerte}}
				<li>{{libelle}}</li>
				{{/each}}
			</ul></i>
		</div>
	</section>

</template>
